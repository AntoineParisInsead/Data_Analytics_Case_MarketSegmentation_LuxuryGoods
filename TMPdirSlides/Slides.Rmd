---

title : (Big) Data Analytics for Business
subtitle : Segmentation in the Boating Industry
author : T. Evgeniou and J. Niessing
job : INSEAD
widgets : []
mode : standalone 

---

## Every factor analysis has three basic decision points




Decide the number of factors

Choose an extraction method

Choose a rotation method

---

## Correlation matrix of the 29 attitudes as a pre-step


```{r echo=FALSE, comment=NA, warning=FALSE, message=FALSE, results='asis'}
thecor=cor(ProjectDataFactor)
colnames(thecor)<-colnames(thecor)
rownames(thecor)<-rownames(thecor)
## printing the result in a clean-slate table
cat(renderHeatmapX(thecor, border=1))

```
** = correlation is significant at 1% level; * = correlation is significant at 5% level


---

## Number of Factors


There are three commen ways to select the number of factors:

1. All factors with eigenvalue larger than 1

2. Based on the cumulative variance we would like to explain (e.g. at least 50% for example).

3. Pick the number of factrors corresponding to the "elbow" of the scree plot



The first two approaches to select the number of factors/derived variables are based on statistical criteria and can be seen in the following table: 

---

## Eigenvalues and explained variance

```{r echo=FALSE, comment=NA, warning=FALSE, error=FALSE,message=FALSE,results='asis'}
Variance_Explained_Table_results<-PCA(ProjectDataFactor, graph=FALSE)
Variance_Explained_Table<-Variance_Explained_Table_results$eig
Variance_Explained_Table_copy<-Variance_Explained_Table
## print result in a clean-slate table
#Variance_Explained_Table[abs(Variance_Explained_Table)<MIN_VALUE]<-NA
print(xtable(Variance_Explained_Table, caption="Eigenvalues and Variance Explained", digits=3), type="html",html.table.attributes = "class='table table-striped table-hover table-bordered'",caption.placement="top",comment = FALSE,include.rownames = TRUE)

row=1:nrow(Variance_Explained_Table)
name<-paste("Component No:",row,sep="")
Variance_Explained_Table<-cbind(name,Variance_Explained_Table)
Variance_Explained_Table<-as.data.frame(Variance_Explained_Table)
colnames(Variance_Explained_Table)<-c("Components", "Eigenvalue", "Percentage_of_explained_variance", "Cumulative_percentage_of_explained_variance")

#print(gvisTable(Variance_Explained_Table, options=list(width=1200, height=400,allowHTML=TRUE,page='disable',pageSize=15,showRowNumber=FALSE,cssClassNames={tableCell='td.tableRow'})),formats=list(Eigenvalue="#,##") ,'chart')

m<-gvisTable(Variance_Explained_Table,options=list(width=1200, height=400,allowHTML=TRUE,page='disable'),formats=list(Eigenvalue="#.##",Percentage_of_explained_variance="#.##",Cumulative_percentage_of_explained_variance="#.##"))
print(m,'chart')
```


---

## A common basic visualization when running the factor analysis is the Screeplot

The screeplot depicts the eigenvalues of the factors and thus allows gaining another quick overview on how many factors should be retained:

```{r Fig2, echo=FALSE, comment=NA, results='asis', message=FALSE, fig.align='center', fig=TRUE}
Unrotated_Results<-principal(ProjectDataFactor, nfactors=ncol(ProjectDataFactor), rotate=rotation_used)
eigenvalues <- Unrotated_Results$values
df           <- cbind(as.data.frame(eigenvalues), c(1:length(eigenvalues)), rep(1, length(eigenvalues)))
colnames(df) <- c("eigenvalues", "components", "abline")
Line         <- gvisLineChart(as.data.frame(df), xvar="components", yvar=c("eigenvalues","abline"), options=list(title='Scree plot', legend="right", width=900, height=600, hAxis="{title:'Number of Components', titleTextStyle:{color:'black'}}", vAxes="[{title:'Eigenvalues'}]",  series="[{color:'green',pointSize:12, targetAxisIndex: 0}]"))
print(Line, 'chart')
```


--- 

## Example Factors

```{r echo=FALSE, comment=NA, warning=FALSE, message=FALSE,results='asis'}
Unrotated_Results<-principal(ProjectDataFactor, nfactors=ncol(ProjectDataFactor), rotate="none")
Unrotated_Factors<-Unrotated_Results$loadings
Unrotated_Factors<-as.data.frame(unclass(Unrotated_Factors))
colnames(Unrotated_Factors)<-paste("Component",1:ncol(Unrotated_Factors),sep=" ")
Unrotated_Factors[abs(Unrotated_Factors) < MIN_VALUE]<-NA
print(xtable(Unrotated_Factors, caption=paste(paste("All PCA factors available (values less than",MIN_VALUE),"are not shown)"), digits=3), type="html",html.table.attributes = "class='table table-striped table-hover table-bordered'",caption.placement="top",comment = FALSE,include.rownames = TRUE,include.colnames = TRUE)
```

--- 

## How Many Factors? Eigenvalues and Variance Explained

```{r echo=FALSE, comment=NA, warning=FALSE, message=FALSE,results='asis'}
Variance_Explained_Table_results<-PCA(ProjectDataFactor, graph=FALSE)
Variance_Explained_Table<-Variance_Explained_Table_results$eig
## print result in a clean-slate table
#Variance_Explained_Table[abs(Variance_Explained_Table)<MIN_VALUE]<-NA
print(xtable(Variance_Explained_Table, caption="Eigenvalues and Variance Explained", digits=3), type="html",html.table.attributes = "class='table table-striped table-hover table-bordered'",caption.placement="top",comment = FALSE,include.rownames = TRUE)
```

--- 

## How Many Factors? Scree Plot

```{r Fig2, echo=FALSE, comment=NA, results='asis', message=FALSE, echo=FALSE, fig.align='center', fig=TRUE}
eigenvalues<-Unrotated_Results$values
## plot eigenvalues
plot(eigenvalues, type="o", main="Scree Plot",xlab="Component Number", ylab="Eigenvalue", col=colors()[26], lwd=2)
## add minor ticks
minor.tick(nx=5, ny=2)
## add abline at y = 1
abline(h=1,lty=2,col=colors()[34]) 
```

--- 

## How many factors?

* The maximal number of factors is the number of original variables Eigenvalue>1
* "Elbow" in the Scree plot
* Cumulative variance explained

---

## Step 5. Interpret the factors and Consider rotation of factors (technical but useful)

Rotated Factors

```{r echo=FALSE, comment=NA, warning=FALSE, message=FALSE,results='asis'}
Rotated_Results<-principal(ProjectDataFactor, nfactors=ncol(ProjectDataFactor), rotate=rotation_used,score=TRUE)
Rotated_Factors<-Rotated_Results$loadings
Rotated_Factors<-as.data.frame(unclass(Rotated_Factors))
colnames(Rotated_Factors)<-paste("Component",1:ncol(Rotated_Factors),sep=" ")

Rotated_Factors[abs(Rotated_Factors) < MIN_VALUE]<-NA

print(xtable(Rotated_Factors, caption=paste(paste(paste("All PCA factors available with Rotation",rotation_used),"(values less than",MIN_VALUE),"are not shown)"), digits=3), type="html",html.table.attributes = "class='table table-striped table-hover table-bordered'",caption.placement="top",comment = FALSE,include.rownames = TRUE,include.colnames = TRUE)
```

---

## What Factor Loads "Look Good"? Three Quality Criteria

1. For each factor (column) only a few loadings are large (in absolute value)

2. For each initial variable (row) only a few loadings are large (in absolute value)

3. Any pair of factors (columns) should have different "patterns" of loading

---

## Step 6. Save factor scores for subsequent analyses


```{r echo=FALSE, comment=NA, warning=FALSE, message=FALSE,results='asis'}
NEW_ProjectData <- Rotated_Results$scores[,1:sum(eigenvalues>=1)]
colnames(NEW_ProjectData)<-paste("Derived Variable (Factor)",1:ncol(NEW_ProjectData),sep=" ")
print(xtable(head(NEW_ProjectData,5) ,paste("Sample Data described using the selected Factors:",data_name,sep=" "), digits=1,),type="html",html.table.attributes = "class='table table-striped table-hover table-bordered'",caption.placement="top",comment = FALSE,include.rownames = TRUE)
```

---

## Using the Factor Scores: Pereptual Maps

```{r Fig3, echo=FALSE, comment=NA, results='asis', message=FALSE, echo=FALSE, fig.align='center', fig=TRUE}
plot(NEW_ProjectData[,1],NEW_ProjectData[,2], main="Data Visualization Using the top 2 Derived Attributes (Factors)",xlab="Derived Variable (Factor) 1", ylab="Derived Variable (Factor) 2", col=colors()[26], lwd=2)
```


## Factor Analysis: Key (Technical) Notions 

1. Correlation
2. Variance explained (eigenvalues)
3. Scree plot
4. Varimax rotation
5. Factor Loadings ("components")
6. Factor scores

---

## Next Class: Cluster Analysis for Segmentation